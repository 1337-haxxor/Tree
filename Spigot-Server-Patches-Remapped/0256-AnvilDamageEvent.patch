From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: BillyGalbreath <Blake.Galbreath@GMail.com>
Date: Fri, 20 Jul 2018 23:37:03 -0500
Subject: [PATCH] AnvilDamageEvent


diff --git a/src/main/java/net/minecraft/inventory/container/RepairContainer.java b/src/main/java/net/minecraft/inventory/container/RepairContainer.java
index ec7d4703dc86e3165f48faa58a92c1e655a59859..b0fbc340888786f7aac24baab93284fb27e9fbbe 100644
--- a/src/main/java/net/minecraft/inventory/container/RepairContainer.java
+++ b/src/main/java/net/minecraft/inventory/container/RepairContainer.java
@@ -82,7 +82,16 @@ public class RepairContainer extends AbstractRepairContainer {
 
             if (!p_230301_1_.field_71075_bZ.field_75098_d && iblockdata.func_235714_a_((ITag) BlockTags.field_200572_k) && p_230301_1_.func_70681_au().nextFloat() < 0.12F) {
                 BlockState iblockdata1 = AnvilBlock.func_196433_f(iblockdata);
-
+                // Paper start
+                com.destroystokyo.paper.event.block.AnvilDamagedEvent event = new com.destroystokyo.paper.event.block.AnvilDamagedEvent(getBukkitView(), iblockdata1 != null ? org.bukkit.craftbukkit.block.data.CraftBlockData.fromData(iblockdata1) : null);
+                if (!event.callEvent()) {
+                    return;
+                } else if (event.getDamageState() == com.destroystokyo.paper.event.block.AnvilDamagedEvent.DamageState.BROKEN) {
+                    iblockdata1 = null;
+                } else {
+                    iblockdata1 = ((org.bukkit.craftbukkit.block.data.CraftBlockData) event.getDamageState().getMaterial().createBlockData()).getState().func_206870_a(AnvilBlock.field_176506_a, iblockdata.func_177229_b(AnvilBlock.field_176506_a));
+                }
+                // Paper end
                 if (iblockdata1 == null) {
                     world.func_217377_a(blockposition, false);
                     world.func_217379_c(1029, blockposition, 0);
