From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Iceee <andrew@opticgaming.tv>
Date: Wed, 2 Mar 2016 01:39:52 -0600
Subject: [PATCH] Fix lag from explosions processing dead entities


diff --git a/src/main/java/net/minecraft/util/EntityPredicates.java b/src/main/java/net/minecraft/util/EntityPredicates.java
index 149cf6907e8bbd0499a52f7723f1bd5a1099cc1c..740a1ec4a40a7b4a86a48e3a820587ba781ce656 100644
--- a/src/main/java/net/minecraft/util/EntityPredicates.java
+++ b/src/main/java/net/minecraft/util/EntityPredicates.java
@@ -22,6 +22,7 @@ public final class EntityPredicates {
     public static final Predicate<Entity> field_96566_b = (entity) -> {
         return entity instanceof IInventory && entity.func_70089_S();
     };
+    public static Predicate<Entity> canAITarget() { return field_188444_d; } // Paper - OBFHELPER
     public static final Predicate<Entity> field_188444_d = (entity) -> {
         return !(entity instanceof PlayerEntity) || !entity.func_175149_v() && !((PlayerEntity) entity).func_184812_l_();
     };
diff --git a/src/main/java/net/minecraft/world/Explosion.java b/src/main/java/net/minecraft/world/Explosion.java
index ed8990a657ff0248c7ada20b9c052b301ab934e9..e2f51e27a7f904cd42d13b742f664e5027b3a5f8 100644
--- a/src/main/java/net/minecraft/world/Explosion.java
+++ b/src/main/java/net/minecraft/world/Explosion.java
@@ -33,6 +33,7 @@ import net.minecraft.loot.LootParameters;
 import net.minecraft.particles.ParticleTypes;
 import net.minecraft.tileentity.TileEntity;
 import net.minecraft.util.DamageSource;
+import net.minecraft.util.EntityPredicates;
 import net.minecraft.util.SoundCategory;
 import net.minecraft.util.SoundEvents;
 import net.minecraft.util.math.AxisAlignedBB;
@@ -180,7 +181,7 @@ public class Explosion {
         int i1 = MathHelper.func_76128_c(this.field_77285_c + (double) f2 + 1.0D);
         int j1 = MathHelper.func_76128_c(this.field_77282_d - (double) f2 - 1.0D);
         int k1 = MathHelper.func_76128_c(this.field_77282_d + (double) f2 + 1.0D);
-        List<Entity> list = this.field_77287_j.func_72839_b(this.field_77283_e, new AxisAlignedBB((double) i, (double) l, (double) j1, (double) j, (double) i1, (double) k1));
+        List<Entity> list = this.field_77287_j.func_175674_a(this.field_77283_e, new AxisAlignedBB((double) i, (double) l, (double) j1, (double) j, (double) i1, (double) k1), (com.google.common.base.Predicate<Entity>) entity -> EntityPredicates.canAITarget().test(entity) && !entity.field_70128_L); // Paper - Fix lag from explosions processing dead entities
         Vector3d vec3d = new Vector3d(this.field_77284_b, this.field_77285_c, this.field_77282_d);
 
         for (int l1 = 0; l1 < list.size(); ++l1) {
