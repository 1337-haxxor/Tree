From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Lukasz Derlatka <toranktto@gmail.com>
Date: Mon, 11 Nov 2019 16:08:13 +0100
Subject: [PATCH] Fix AssertionError when player hand set to empty type

Fixes an AssertionError when setting the player's item in hand to null or a new ItemStack of Air in PlayerInteractEvent
Fixes GH-2718

diff --git a/src/main/java/net/minecraft/entity/LivingEntity.java b/src/main/java/net/minecraft/entity/LivingEntity.java
index 31bc8de3f5d4fc36b52156993c0aca8cf38853a1..b5b68d133c726dffb16731c04dc6fca7347021fb 100644
--- a/src/main/java/net/minecraft/entity/LivingEntity.java
+++ b/src/main/java/net/minecraft/entity/LivingEntity.java
@@ -2146,6 +2146,7 @@ public abstract class LivingEntity extends Entity {
         return p_233634_1_.test(this.func_184614_ca().func_77973_b()) || p_233634_1_.test(this.func_184592_cb().func_77973_b());
     }
 
+    public final ItemStack getItemInHand(Hand enumhand) { return this.func_184586_b(enumhand); } // Paper - OBFHELPER
     public ItemStack func_184586_b(Hand p_184586_1_) {
         if (p_184586_1_ == Hand.MAIN_HAND) {
             return this.func_184582_a(EquipmentSlotType.MAINHAND);
diff --git a/src/main/java/net/minecraft/network/play/ServerPlayNetHandler.java b/src/main/java/net/minecraft/network/play/ServerPlayNetHandler.java
index e4f9ed78921b6d2e474b10cce3ad1419a57b3207..c1ab4a9eb5a2138ac406fe0194c03a0ede818b60 100644
--- a/src/main/java/net/minecraft/network/play/ServerPlayNetHandler.java
+++ b/src/main/java/net/minecraft/network/play/ServerPlayNetHandler.java
@@ -1693,6 +1693,10 @@ public class ServerPlayNetHandler implements IServerPlayNetHandler {
                 this.field_147369_b.getBukkitEntity().updateInventory(); // SPIGOT-2524
                 return;
             }
+            // Paper start
+            itemstack = this.field_147369_b.getItemInHand(enumhand);
+            if (itemstack.func_190926_b()) return;
+            // Paper end
             ActionResultType enuminteractionresult = this.field_147369_b.field_71134_c.func_187250_a(this.field_147369_b, worldserver, itemstack, enumhand);
 
             if (enuminteractionresult.func_226247_b_()) {
