From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Paul Sauve <paul@burngames.net>
Date: Sun, 14 Jul 2019 21:05:03 -0500
Subject: [PATCH] Do less work if we have a custom Bukkit generator

If the Bukkit generator already has a spawn, use it immediately instead
of spending time generating one that we won't use

diff --git a/src/main/java/net/minecraft/server/MinecraftServer.java b/src/main/java/net/minecraft/server/MinecraftServer.java
index 630174a0f5dea97f86ae530d92864d0ab5f9fb30..a1c163bee8451716f8beffcafbbb456eb44a6f50 100644
--- a/src/main/java/net/minecraft/server/MinecraftServer.java
+++ b/src/main/java/net/minecraft/server/MinecraftServer.java
@@ -617,11 +617,7 @@ public abstract class MinecraftServer extends RecursiveEventLoop<TickDelayedTask
         } else if (p_240786_3_) {
             p_240786_1_.func_176143_a(BlockPos.field_177992_a.func_177984_a());
         } else {
-            BiomeProvider worldchunkmanager = chunkgenerator.func_202090_b();
-            List<Biome> list = worldchunkmanager.func_76932_a();
-            Random random = new Random(p_240786_0_.func_72905_C());
-            BlockPos blockposition = worldchunkmanager.func_225531_a_(0, p_240786_0_.func_181545_F(), 0, 256, list, random);
-            ChunkPos chunkcoordintpair = blockposition == null ? new ChunkPos(0, 0) : new ChunkPos(blockposition);
+            // Paper start - moved down
             // CraftBukkit start
             if (p_240786_0_.generator != null) {
                 Random rand = new Random(p_240786_0_.func_72905_C());
@@ -637,6 +633,14 @@ public abstract class MinecraftServer extends RecursiveEventLoop<TickDelayedTask
                 }
             }
             // CraftBukkit end
+            // Paper start - if the generator created a spawn for us, then there is no need for us to also create a spawn -
+            // only do it if the generator did not
+            BiomeProvider worldchunkmanager = chunkgenerator.func_202090_b();
+            List<Biome> list = worldchunkmanager.func_76932_a();
+            Random random = new Random(p_240786_0_.func_72905_C());
+            BlockPos blockposition = worldchunkmanager.func_225531_a_(0, p_240786_0_.func_181545_F(), 0, 256, list, random);
+            ChunkPos chunkcoordintpair = blockposition == null ? new ChunkPos(0, 0) : new ChunkPos(blockposition);
+            // Paper end
 
             if (blockposition == null) {
                 MinecraftServer.field_147145_h.warn("Unable to find spawn biome");
