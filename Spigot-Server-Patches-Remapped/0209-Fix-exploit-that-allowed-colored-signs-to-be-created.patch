From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: 0x22 <0x22@futureclient.net>
Date: Thu, 26 Apr 2018 04:41:11 -0400
Subject: [PATCH] Fix exploit that allowed colored signs to be created


diff --git a/src/main/java/net/minecraft/network/play/ServerPlayNetHandler.java b/src/main/java/net/minecraft/network/play/ServerPlayNetHandler.java
index 1e964a144ab50af3984df9e9f09a9462fdb06ad6..6d476806070763d0e02ef2b7c3f28b8fd4f4d4bf 100644
--- a/src/main/java/net/minecraft/network/play/ServerPlayNetHandler.java
+++ b/src/main/java/net/minecraft/network/play/ServerPlayNetHandler.java
@@ -2777,7 +2777,7 @@ public class ServerPlayNetHandler implements IServerPlayNetHandler {
             String[] lines = new String[4];
 
             for (int i = 0; i < p_244542_2_.size(); ++i) {
-                lines[i] = TextFormatting.func_110646_a(new StringTextComponent(TextFormatting.func_110646_a((String) p_244542_2_.get(i))).getString());
+                lines[i] = SharedConstants.filterAllowedChatCharacters(p_244542_2_.get(i)); // Paper - Replaced with anvil color stripping method to stop exploits that allow colored signs to be created.
             }
             SignChangeEvent event = new SignChangeEvent((org.bukkit.craftbukkit.block.CraftBlock) player.getWorld().getBlockAt(x, y, z), this.server.getPlayer(this.field_147369_b), lines);
             this.server.getPluginManager().callEvent(event);
diff --git a/src/main/java/net/minecraft/util/SharedConstants.java b/src/main/java/net/minecraft/util/SharedConstants.java
index 85da417b4433beff5de68130e0ab3479512e84cb..6d157bcd2ce4e3279112ab775f350981a2ba0887 100644
--- a/src/main/java/net/minecraft/util/SharedConstants.java
+++ b/src/main/java/net/minecraft/util/SharedConstants.java
@@ -20,6 +20,7 @@ public class SharedConstants {
         return p_71566_0_ != 167 && p_71566_0_ >= ' ' && p_71566_0_ != 127;
     }
 
+    public static String filterAllowedChatCharacters(String input) { return func_71565_a(input); } // Paper - OBFHELPER
     public static String func_71565_a(String p_71565_0_) {
         StringBuilder stringbuilder = new StringBuilder();
         char[] achar = p_71565_0_.toCharArray();
