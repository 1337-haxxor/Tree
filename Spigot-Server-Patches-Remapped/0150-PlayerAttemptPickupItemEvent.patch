From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: BillyGalbreath <Blake.Galbreath@GMail.com>
Date: Sun, 11 Jun 2017 16:30:30 -0500
Subject: [PATCH] PlayerAttemptPickupItemEvent


diff --git a/src/main/java/net/minecraft/entity/item/ItemEntity.java b/src/main/java/net/minecraft/entity/item/ItemEntity.java
index b9768aea3c408c1e5399b9f12666110f940045eb..62ccbe90d78efab9aea812d662f253d2b6c23a2b 100644
--- a/src/main/java/net/minecraft/entity/item/ItemEntity.java
+++ b/src/main/java/net/minecraft/entity/item/ItemEntity.java
@@ -35,6 +35,7 @@ import net.minecraft.world.server.ServerWorld;
 import org.bukkit.event.entity.EntityPickupItemEvent;
 import org.bukkit.event.player.PlayerPickupItemEvent;
 // CraftBukkit end
+import org.bukkit.event.player.PlayerAttemptPickupItemEvent; // Paper
 
 public class ItemEntity extends Entity {
 
@@ -364,6 +365,22 @@ public class ItemEntity extends Entity {
             int remaining = i - canHold;
             boolean flyAtPlayer = false; // Paper
 
+            // Paper start
+            if (this.field_145804_b <= 0) {
+                PlayerAttemptPickupItemEvent attemptEvent = new PlayerAttemptPickupItemEvent((org.bukkit.entity.Player) p_70100_1_.getBukkitEntity(), (org.bukkit.entity.Item) this.getBukkitEntity(), remaining);
+                this.field_70170_p.getServer().getPluginManager().callEvent(attemptEvent);
+
+                flyAtPlayer = attemptEvent.getFlyAtPlayer();
+                if (attemptEvent.isCancelled()) {
+                    if (flyAtPlayer) {
+                        p_70100_1_.func_71001_a(this, i);
+                    }
+
+                    return;
+                }
+            }
+            // Paper end
+
             if (this.field_145804_b <= 0 && canHold > 0) {
                 itemstack.func_190920_e(canHold);
                 // Call legacy event
