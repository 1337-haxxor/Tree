From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: MiniDigger <admin@minidigger.me>
Date: Sat, 6 Jun 2020 18:13:42 +0200
Subject: [PATCH] Support components in ItemMeta


diff --git a/src/main/java/net/minecraft/util/text/ITextComponent.java b/src/main/java/net/minecraft/util/text/ITextComponent.java
index 6cabb870d181226b344da3ce79e4abbfdd714fd8..47eb48cad651e1cac7af35f08903c86558882f3f 100644
--- a/src/main/java/net/minecraft/util/text/ITextComponent.java
+++ b/src/main/java/net/minecraft/util/text/ITextComponent.java
@@ -348,6 +348,7 @@ public interface ITextComponent extends Message, ITextProperties, Iterable<IText
             return jsonobject;
         }
 
+        public static String componentToJson(ITextComponent ichatbasecomponent) { return func_150696_a(ichatbasecomponent);} // Paper - OBFHELPER
         public static String func_150696_a(ITextComponent p_150696_0_) {
             return ITextComponent.Serializer.field_150700_a.toJson(p_150696_0_);
         }
diff --git a/src/main/java/org/bukkit/craftbukkit/inventory/CraftMetaItem.java b/src/main/java/org/bukkit/craftbukkit/inventory/CraftMetaItem.java
index 5431895dcdfdd99cb0b77c7335573b07533f52a0..55d4d7cf7b95beda40c3fd1b998b55f4409353fe 100644
--- a/src/main/java/org/bukkit/craftbukkit/inventory/CraftMetaItem.java
+++ b/src/main/java/org/bukkit/craftbukkit/inventory/CraftMetaItem.java
@@ -873,11 +873,23 @@ class CraftMetaItem implements ItemMeta, Damageable, Repairable, BlockDataMeta {
         return CraftChatMessage.fromComponent(displayName);
     }
 
+    // Paper start
+    @Override
+    public net.md_5.bungee.api.chat.BaseComponent[] getDisplayNameComponent() {
+        return net.md_5.bungee.chat.ComponentSerializer.parse(ITextComponent.Serializer.componentToJson(displayName));
+    }
+    // Paper end
     @Override
     public final void setDisplayName(String name) {
         this.displayName = CraftChatMessage.fromStringOrNull(name);
     }
 
+    // Paper start
+    @Override
+    public void setDisplayNameComponent(net.md_5.bungee.api.chat.BaseComponent[] component) {
+        this.displayName = ITextComponent.Serializer.jsonToComponent(net.md_5.bungee.chat.ComponentSerializer.toString(component));
+    }
+    // Paper end
     @Override
     public boolean hasDisplayName() {
         return displayName != null;
@@ -1008,6 +1020,14 @@ class CraftMetaItem implements ItemMeta, Damageable, Repairable, BlockDataMeta {
         return this.lore == null ? null : new ArrayList<String>(Lists.transform(this.lore, CraftChatMessage::fromComponent));
     }
 
+    // Paper start
+    @Override
+    public List<net.md_5.bungee.api.chat.BaseComponent[]> getLoreComponents() {
+        return this.lore == null ? null : new ArrayList<>(this.lore.stream().map(entry ->
+            net.md_5.bungee.chat.ComponentSerializer.parse(ITextComponent.Serializer.componentToJson(entry)
+        )).collect(java.util.stream.Collectors.toList()));
+    }
+    // Paper end
     @Override
     public void setLore(List<String> lore) { // too tired to think if .clone is better
         if (lore == null) {
@@ -1022,6 +1042,21 @@ class CraftMetaItem implements ItemMeta, Damageable, Repairable, BlockDataMeta {
         }
     }
 
+    // Paper start
+    @Override
+    public void setLoreComponents(List<net.md_5.bungee.api.chat.BaseComponent[]> lore) {
+        if (lore == null) {
+            this.lore = null;
+        } else {
+            if (this.lore == null) {
+                safelyAdd(lore, this.lore = new ArrayList<>(lore.size()), Integer.MAX_VALUE);
+            } else {
+                this.lore.clear();
+                safelyAdd(lore, this.lore, Integer.MAX_VALUE);
+            }
+        }
+    }
+    // Paper end
     @Override
     public boolean hasCustomModelData() {
         return customModelData != null;
@@ -1483,6 +1518,11 @@ class CraftMetaItem implements ItemMeta, Damageable, Repairable, BlockDataMeta {
         }
 
         for (Object object : addFrom) {
+            // Paper start - support components
+            if(object instanceof net.md_5.bungee.api.chat.BaseComponent[]) {
+                addTo.add(ITextComponent.Serializer.jsonToComponent(net.md_5.bungee.chat.ComponentSerializer.toString((net.md_5.bungee.api.chat.BaseComponent[]) object)));
+            } else
+            // Paper end
             if (!(object instanceof String)) {
                 if (object != null) {
                     throw new IllegalArgumentException(addFrom + " cannot contain non-string " + object.getClass().getName());
