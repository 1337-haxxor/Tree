From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Phoenix616 <mail@moep.tv>
Date: Sun, 7 Jun 2020 21:43:42 +0100
Subject: [PATCH] Maps shouldn't load chunks

Previously maps would load all chunks in a certain radius depending on
 their scale when trying to update their content. This would result in
 main thread chunk loads when they weren't really necessary, especially
 on low view distances or "slow" async chunk loads after teleports or
 other prioritisation.

 This changes it to only try to render already loaded chunks based on
 the assumption that the chunks around the player will get loaded
 eventually anyways and that maps will get checked for update every
 five ticks that movement occur in anyways.

diff --git a/src/main/java/net/minecraft/item/FilledMapItem.java b/src/main/java/net/minecraft/item/FilledMapItem.java
index 9ed99f175c8b04602bb4f614b5c88bb160a9b764..88d021b931bd5184b9df69138b96b9a3398a5e7b 100644
--- a/src/main/java/net/minecraft/item/FilledMapItem.java
+++ b/src/main/java/net/minecraft/item/FilledMapItem.java
@@ -118,9 +118,9 @@ public class FilledMapItem extends AbstractMapItem {
                             int k2 = (j / i + k1 - 64) * i;
                             int l2 = (k / i + l1 - 64) * i;
                             Multiset<MaterialColor> multiset = LinkedHashMultiset.create();
-                            Chunk chunk = p_77872_1_.func_175726_f(new BlockPos(k2, 0, l2));
+                            Chunk chunk = p_77872_1_.getChunkIfLoaded(new BlockPos(k2, 0, l2)); // Paper - Maps shouldn't load chunks
 
-                            if (!chunk.func_76621_g()) {
+                            if (chunk != null && !chunk.func_76621_g()) { // Paper - Maps shouldn't load chunks
                                 ChunkPos chunkcoordintpair = chunk.func_76632_l();
                                 int i3 = k2 & 15;
                                 int j3 = l2 & 15;
