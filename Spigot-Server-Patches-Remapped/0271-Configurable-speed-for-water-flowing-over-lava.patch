From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Byteflux <byte@byteflux.net>
Date: Wed, 8 Aug 2018 16:33:21 -0600
Subject: [PATCH] Configurable speed for water flowing over lava


diff --git a/src/main/java/com/destroystokyo/paper/PaperWorldConfig.java b/src/main/java/com/destroystokyo/paper/PaperWorldConfig.java
index 5ea60c713426f11e420360a08a9ea1039d4f6b02..d8afb247f180b89f89cbed0f6e6c4fcc527799ff 100644
--- a/src/main/java/com/destroystokyo/paper/PaperWorldConfig.java
+++ b/src/main/java/com/destroystokyo/paper/PaperWorldConfig.java
@@ -384,4 +384,10 @@ public class PaperWorldConfig {
         this.armorStandTick = this.getBoolean("armor-stands-tick", this.armorStandTick);
         log("ArmorStand ticking is " + (this.armorStandTick ? "enabled" : "disabled") + " by default");
     }
+
+    public int waterOverLavaFlowSpeed;
+    private void waterOverLavaFlowSpeed() {
+        waterOverLavaFlowSpeed = getInt("water-over-lava-flow-speed", 5);
+        log("Water over lava flow speed: " + waterOverLavaFlowSpeed);
+    }
 }
diff --git a/src/main/java/net/minecraft/block/FlowingFluidBlock.java b/src/main/java/net/minecraft/block/FlowingFluidBlock.java
index 3c3501a1d0672056b5db92443942f1c6d36ea3b7..e823beb9ecb4734c78d8ee7537766e2fd52e7f21 100644
--- a/src/main/java/net/minecraft/block/FlowingFluidBlock.java
+++ b/src/main/java/net/minecraft/block/FlowingFluidBlock.java
@@ -4,6 +4,7 @@ import com.google.common.collect.Lists;
 import java.util.Collections;
 import java.util.List;
 import java.util.Random;
+import net.minecraft.block.material.Material;
 import net.minecraft.fluid.FlowingFluid;
 import net.minecraft.fluid.Fluid;
 import net.minecraft.fluid.FluidState;
@@ -98,11 +99,28 @@ public class FlowingFluidBlock extends Block implements IBucketPickupHandler {
     @Override
     public void func_220082_b(BlockState p_220082_1_, World p_220082_2_, BlockPos p_220082_3_, BlockState p_220082_4_, boolean p_220082_5_) {
         if (this.func_204515_c(p_220082_2_, p_220082_3_, p_220082_1_)) {
-            p_220082_2_.func_205219_F_().func_205360_a(p_220082_3_, p_220082_1_.func_204520_s().func_206886_c(), this.field_204517_c.func_205569_a((IWorldReader) p_220082_2_));
+            p_220082_2_.func_205219_F_().func_205360_a(p_220082_3_, p_220082_1_.func_204520_s().func_206886_c(), this.getFlowSpeed(p_220082_2_, p_220082_3_)); // Paper
         }
 
     }
 
+    // Paper start - Get flow speed. Throttle if its water and flowing adjacent to lava
+    public int getFlowSpeed(World world, BlockPos blockposition) {
+        if (this.field_149764_J == Material.field_151586_h) {
+            if (
+                world.getMaterialIfLoaded(blockposition.func_177964_d(1)) == Material.field_151587_i ||
+                world.getMaterialIfLoaded(blockposition.func_177970_e(1)) == Material.field_151587_i ||
+                world.getMaterialIfLoaded(blockposition.func_177985_f(1)) == Material.field_151587_i ||
+                world.getMaterialIfLoaded(blockposition.func_177965_g(1)) == Material.field_151587_i
+            ) {
+                return world.paperConfig.waterOverLavaFlowSpeed;
+            }
+        }
+        return this.field_204517_c.func_205569_a(world);
+    }
+    // Paper end
+
+
     @Override
     public BlockState func_196271_a(BlockState p_196271_1_, Direction p_196271_2_, BlockState p_196271_3_, IWorld p_196271_4_, BlockPos p_196271_5_, BlockPos p_196271_6_) {
         if (p_196271_1_.func_204520_s().func_206889_d() || p_196271_3_.func_204520_s().func_206889_d()) {
@@ -115,7 +133,7 @@ public class FlowingFluidBlock extends Block implements IBucketPickupHandler {
     @Override
     public void func_220069_a(BlockState p_220069_1_, World p_220069_2_, BlockPos p_220069_3_, Block p_220069_4_, BlockPos p_220069_5_, boolean p_220069_6_) {
         if (this.func_204515_c(p_220069_2_, p_220069_3_, p_220069_1_)) {
-            p_220069_2_.func_205219_F_().func_205360_a(p_220069_3_, p_220069_1_.func_204520_s().func_206886_c(), this.field_204517_c.func_205569_a((IWorldReader) p_220069_2_));
+            p_220069_2_.func_205219_F_().func_205360_a(p_220069_3_, p_220069_1_.func_204520_s().func_206886_c(), this.getFlowSpeed(p_220069_2_, p_220069_3_)); // Paper
         }
 
     }
